<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tbilisi City Quest ‚Äî Feedback</title>

  <style>
    body{font-family:system-ui,Arial;margin:0;background:#f6f7fb;color:#111827}
    .wrap{max-width:980px;margin:0 auto;padding:20px}
    .card{background:#fff;border-radius:16px;padding:18px;box-shadow:0 6px 24px rgba(0,0,0,.06);margin-bottom:14px}
    h1{margin:0 0 6px;font-size:22px}
    .muted{color:#667085;font-size:14px;line-height:1.45}
    .qtitle{margin:0 0 6px;font-size:18px;font-weight:800}
    .qsub{margin:0 0 10px;font-size:13px;color:#667085}
    label{display:block;margin:10px 0 6px;font-weight:700}
    input[type="text"], textarea, select{
      width:100%;box-sizing:border-box;border:1px solid #d0d5dd;border-radius:12px;
      padding:10px 12px;font-size:15px;background:#fff
    }
    textarea{min-height:90px;resize:vertical}
    .options{display:flex;flex-direction:column;gap:8px;margin-top:8px}
    .opt{display:flex;gap:10px;align-items:flex-start}
    .opt input{margin-top:3px}
    .hr{height:1px;background:#eef2f6;margin:16px 0}
    .btn{
      display:inline-block;background:#111827;color:#fff;border:0;border-radius:12px;
      padding:10px 14px;font-size:15px;cursor:pointer
    }
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .ok{color:#16a34a;font-weight:800;margin-top:10px}
    .err{color:#dc2626;font-weight:800;margin-top:10px}
    .langbar{display:flex;gap:10px;align-items:center;justify-content:space-between}
    .langbtns{display:flex;gap:8px}
    .chip{
      border:1px solid #d0d5dd;background:#fff;border-radius:999px;
      padding:8px 12px;font-size:14px;cursor:pointer
    }
    .chip.active{background:#111827;color:#fff;border-color:#111827}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:760px){ .grid2{grid-template-columns:1fr} }
  </style>
</head>

<body>
<div class="wrap">

  <div class="card">
    <div class="langbar">
      <div>
        <h1 data-i18n="title">Tbilisi City Quest ‚Äî Feedback</h1>
        <div class="muted" data-i18n="intro">
          Thank you for joining the quest! This feedback helps me improve the next quests.
        </div>
      </div>
      <div class="langbtns">
        <button type="button" class="chip active" id="btnEN">EN</button>
        <button type="button" class="chip" id="btnRU">RU</button>
      </div>
    </div>
  </div>

  <form id="feedbackForm" class="card">

    <input type="hidden" name="lang" id="lang" value="en"/>
    <input type="hidden" name="device_time" id="device_time"/>
    <input type="hidden" name="source_page" id="source_page"/>

    <!-- Q1 -->
    <div class="qtitle" data-i18n="q1_title">How did you like the Tbilisi City Quest? (1‚Äì10)</div>
    <div class="qsub" data-i18n="q1_sub">10 means ‚Äúloved it‚Äù.</div>
    <select name="overall_10" required>
      <option value="">Select</option>
      <option>10</option><option>9</option><option>8</option><option>7</option><option>6</option>
      <option>5</option><option>4</option><option>3</option><option>2</option><option>1</option>
    </select>

    <div class="hr"></div>

    <!-- Q4 Hard tasks -->
    <div class="qtitle" data-i18n="q4_title">Were any tasks too hard or unclear?</div>
    <div class="qsub" data-i18n="q4_sub">Choose all that apply.</div>

    <div class="options" id="hardTasksBlock">
      <label class="opt">
        <input type="checkbox" name="hard_tasks_opt" value="None" data-none>
        <span data-i18n="none">None</span>
      </label>

      <label class="opt"><input type="checkbox" name="hard_tasks_opt" value="Task 1">
        <span><b>Biltmore Hotel</b> ‚Äî <span data-i18n="t1d">The philosopher‚Äôs last name</span></span>
      </label>

      <label class="opt"><input type="checkbox" name="hard_tasks_opt" value="Task 2">
        <span><b>MoMA</b> ‚Äî <span data-i18n="t2d">Apple</span></span>
      </label>

      <label class="opt"><input type="checkbox" name="hard_tasks_opt" value="Task 3">
        <span><b>National Gallery</b> ‚Äî <span data-i18n="t3d">Artist with a brush and palette</span></span>
      </label>

      <label class="opt"><input type="checkbox" name="hard_tasks_opt" value="Task 4">
        <span><b>Alexander Park</b> ‚Äî <span data-i18n="t4d">Artist‚Äôs monument and a dog</span></span>
      </label>

      <label class="opt"><input type="checkbox" name="hard_tasks_opt" value="Task 5">
        <span><b>Orbeliani Garden</b> ‚Äî <span data-i18n="t5d">Six musicians, one with a bow tie</span></span>
      </label>

      <label class="opt"><input type="checkbox" name="hard_tasks_opt" value="Task 6">
        <span><b>Laghidze</b> ‚Äî <span data-i18n="t6d">Composer</span></span>
      </label>

      <label class="opt"><input type="checkbox" name="hard_tasks_opt" value="Task 7">
        <span><b>Ambassadori Hotel</b> ‚Äî <span data-i18n="t7d">Pirosmani picture hero</span></span>
      </label>

      <label class="opt"><input type="checkbox" name="hard_tasks_opt" value="Task 8">
        <span><b>Ietim Gurji</b> ‚Äî <span data-i18n="t8d">Singer and bird</span></span>
      </label>

      <label class="opt"><input type="checkbox" name="hard_tasks_opt" value="Task 9">
        <span><b>Canyon</b> ‚Äî <span data-i18n="t9d">‚ÄúDNA of Love‚Äù</span></span>
      </label>
    </div>

    <div class="hr"></div>

    <button class="btn" type="submit">Send feedback</button>
    <div id="msg"></div>

  </form>
</div>

<script type="module">
  import { API_URL } from './config.js';

  const form = document.getElementById('feedbackForm');
  document.getElementById('device_time').value = new Date().toISOString();
  document.getElementById('source_page').value = location.href;

  /* === HARD TASKS PROTECTION === */
  const block = document.getElementById('hardTasksBlock');
  const noneBox = block.querySelector('[data-none]');
  const taskBoxes = block.querySelectorAll('input[name="hard_tasks_opt"]:not([data-none])');

  noneBox.addEventListener('change', () => {
    if (noneBox.checked) {
      taskBoxes.forEach(b => { b.checked = false; b.disabled = true; });
    } else {
      taskBoxes.forEach(b => b.disabled = false);
    }
  });

  taskBoxes.forEach(b => {
    b.addEventListener('change', () => {
      if (b.checked) noneBox.checked = false;
      noneBox.disabled = Array.from(taskBoxes).some(t => t.checked);
    });
  });

  form.addEventListener('submit', async e => {
    e.preventDefault();
    const data = new URLSearchParams(new FormData(form));
    await fetch(API_URL, { method:'POST', mode:'no-cors', body:data });
    document.getElementById('msg').textContent = 'Thank you! üôå';
    form.reset();
  });
</script>

</body>
</html>
