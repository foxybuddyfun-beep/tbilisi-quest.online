<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tbilisi City Quest ‚Äî Feedback</title>

  <style>
    body{font-family:system-ui,Arial;margin:0;background:#f6f7fb;color:#111827}
    .wrap{max-width:980px;margin:0 auto;padding:20px}
    .card{background:#fff;border-radius:16px;padding:18px;box-shadow:0 6px 24px rgba(0,0,0,.06);margin-bottom:14px}
    h1{margin:0 0 6px;font-size:22px}
    .muted{color:#667085;font-size:14px;line-height:1.45}
    h2{margin:18px 0 10px;font-size:18px}
    label{display:block;margin:10px 0 6px;font-weight:600}
    input[type="text"], textarea, select{
      width:100%;box-sizing:border-box;border:1px solid #d0d5dd;border-radius:12px;
      padding:10px 12px;font-size:15px;background:#fff
    }
    textarea{min-height:90px;resize:vertical}
    .options{display:flex;flex-direction:column;gap:8px;margin-top:8px}
    .opt{display:flex;gap:10px;align-items:flex-start}
    .opt input{margin-top:3px}
    .hr{height:1px;background:#eef2f6;margin:16px 0}
    .btn{
      display:inline-block;background:#111827;color:#fff;border:0;border-radius:12px;
      padding:10px 14px;font-size:15px;cursor:pointer
    }
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .ok{color:#16a34a;font-weight:700;margin-top:10px}
    .err{color:#dc2626;font-weight:700;margin-top:10px}
    .small{font-size:13px;color:#667085}
    .langbar{display:flex;gap:10px;align-items:center;justify-content:space-between}
    .langbtns{display:flex;gap:8px}
    .chip{
      border:1px solid #d0d5dd;background:#fff;border-radius:999px;
      padding:8px 12px;font-size:14px;cursor:pointer
    }
    .chip.active{background:#111827;color:#fff;border-color:#111827}
    a{color:#111827}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:760px){ .grid2{grid-template-columns:1fr} }
  </style>
</head>

<body>
<div class="wrap">

  <!-- Header -->
  <div class="card">
    <div class="langbar">
      <div>
        <h1 data-i18n="title">Tbilisi City Quest ‚Äî Feedback</h1>
        <div class="muted" data-i18n="intro">
          Thank you for joining the quest! This feedback helps me improve the next quests.
        </div>
      </div>
      <div class="langbtns">
        <button type="button" class="chip active" id="btnEN">EN</button>
        <button type="button" class="chip" id="btnRU">RU</button>
      </div>
    </div>

    <div class="hr"></div>

    <div class="muted" data-i18n="timehint">
      This form takes ~5 minutes. Please answer honestly ‚Äî it really helps üôå
    </div>
  </div>

  <!-- Form -->
  <form id="feedbackForm" class="card">

    <!-- hidden meta -->
    <input type="hidden" name="lang" id="lang" value="en"/>
    <input type="hidden" name="device_time" id="device_time" value=""/>
    <input type="hidden" name="source_page" id="source_page" value=""/>

    <!-- 1) Overall 10 -->
    <h2 data-i18n="sec1">1Ô∏è‚É£ Overall</h2>
    <label for="overall_10" data-i18n="q_overall_10">How did you like the Tbilisi City Quest? (1‚Äì10)</label>
    <select id="overall_10" name="overall_10" required>
      <option value="" data-i18n="select">Select</option>
      <option value="10">10</option><option value="9">9</option><option value="8">8</option><option value="7">7</option><option value="6">6</option>
      <option value="5">5</option><option value="4">4</option><option value="3">3</option><option value="2">2</option><option value="1">1</option>
    </select>

    <div class="hr"></div>

    <!-- 2) What liked most -->
    <h2 data-i18n="sec2">2Ô∏è‚É£ What did you like the most?</h2>
    <label data-i18n="q_liked_most">Choose all that apply</label>
    <div class="options">
      <label class="opt"><input type="checkbox" name="liked_most_opt" value="Tasks & questions"><span data-i18n="lm1">Tasks & questions</span></label>
      <label class="opt"><input type="checkbox" name="liked_most_opt" value="Culture & history"><span data-i18n="lm2">Culture & history</span></label>
      <label class="opt"><input type="checkbox" name="liked_most_opt" value="Route & city"><span data-i18n="lm3">Route & city</span></label>
      <label class="opt"><input type="checkbox" name="liked_most_opt" value="Bonus questions"><span data-i18n="lm4">Bonus questions</span></label>
      <label class="opt"><input type="checkbox" name="liked_most_opt" value="Improv game at the hotel"><span data-i18n="lm5">Improv game at the hotel</span></label>
      <label class="opt"><input type="checkbox" name="liked_most_opt" value="Khinkali at Zodiaco"><span data-i18n="lm6">Khinkali at Zodiaco</span></label>
    </div>

    <div class="hr"></div>

    <!-- 3) What types to add -->
    <h2 data-i18n="sec3">3Ô∏è‚É£ What task types would you add?</h2>
    <label data-i18n="q_add_types">Choose all that apply</label>
    <div class="options">
      <label class="opt"><input type="checkbox" name="add_types_opt" value="Logic puzzles"><span data-i18n="at1">Logic puzzles</span></label>
      <label class="opt"><input type="checkbox" name="add_types_opt" value="Music contests"><span data-i18n="at2">Music contests</span></label>
      <label class="opt"><input type="checkbox" name="add_types_opt" value="Painting / draw something"><span data-i18n="at3">Painting / draw something</span></label>
      <label class="opt"><input type="checkbox" name="add_types_opt" value="Emotional / scary tasks"><span data-i18n="at4">Emotional / scary tasks</span></label>
      <label class="opt"><input type="checkbox" name="add_types_opt" value="Sport / obstacle challenges"><span data-i18n="at5">Sport / obstacle challenges</span></label>
    </div>

    <div class="hr"></div>

    <!-- 4) Hard task -->
    <h2 data-i18n="sec4">4Ô∏è‚É£ Hard or unclear tasks</h2>
    <label for="hard_task" data-i18n="q_hard_task">Were any tasks too hard? (choose one)</label>
    <select id="hard_task" name="hard_task">
      <option value="" data-i18n="select">Select</option>
      <option value="None" data-i18n="none">None</option>
      <option value="Task 1">Task 1</option>
      <option value="Task 2">Task 2</option>
      <option value="Task 3">Task 3</option>
      <option value="Task 4">Task 4</option>
      <option value="Task 5">Task 5</option>
      <option value="Task 6">Task 6</option>
      <option value="Task 7">Task 7</option>
      <option value="Task 8">Task 8</option>
      <option value="Task 9">Task 9</option>
    </select>
    <div class="small" data-i18n="hard_note">
      (You can rename ‚ÄúTask 1‚Ä¶9‚Äù to your real task names anytime.)
    </div>

    <div class="hr"></div>

    <!-- 5) Rate each of 9 tasks -->
    <h2 data-i18n="sec5">5Ô∏è‚É£ Rate each task (1‚Äì5)</h2>
    <div class="grid2">
      <div>
        <label for="task1_rating" data-i18n="t1">Task 1 rating</label>
        <select id="task1_rating" name="task1_rating"><option value="">Select</option><option value="5">5</option><option value="4">4</option><option value="3">3</option><option value="2">2</option><option value="1">1</option></select>
      </div>
      <div>
        <label for="task2_rating" data-i18n="t2">Task 2 rating</label>
        <select id="task2_rating" name="task2_rating"><option value="">Select</option><option value="5">5</option><option value="4">4</option><option value="3">3</option><option value="2">2</option><option value="1">1</option></select>
      </div>
      <div>
        <label for="task3_rating" data-i18n="t3">Task 3 rating</label>
        <select id="task3_rating" name="task3_rating"><option value="">Select</option><option value="5">5</option><option value="4">4</option><option value="3">3</option><option value="2">2</option><option value="1">1</option></select>
      </div>
      <div>
        <label for="task4_rating" data-i18n="t4">Task 4 rating</label>
        <select id="task4_rating" name="task4_rating"><option value="">Select</option><option value="5">5</option><option value="4">4</option><option value="3">3</option><option value="2">2</option><option value="1">1</option></select>
      </div>
      <div>
        <label for="task5_rating" data-i18n="t5">Task 5 rating</label>
        <select id="task5_rating" name="task5_rating"><option value="">Select</option><option value="5">5</option><option value="4">4</option><option value="3">3</option><option value="2">2</option><option value="1">1</option></select>
      </div>
      <div>
        <label for="task6_rating" data-i18n="t6">Task 6 rating</label>
        <select id="task6_rating" name="task6_rating"><option value="">Select</option><option value="5">5</option><option value="4">4</option><option value="3">3</option><option value="2">2</option><option value="1">1</option></select>
      </div>
      <div>
        <label for="task7_rating" data-i18n="t7">Task 7 rating</label>
        <select id="task7_rating" name="task7_rating"><option value="">Select</option><option value="5">5</option><option value="4">4</option><option value="3">3</option><option value="2">2</option><option value="1">1</option></select>
      </div>
      <div>
        <label for="task8_rating" data-i18n="t8">Task 8 rating</label>
        <select id="task8_rating" name="task8_rating"><option value="">Select</option><option value="5">5</option><option value="4">4</option><option value="3">3</option><option value="2">2</option><option value="1">1</option></select>
      </div>
      <div>
        <label for="task9_rating" data-i18n="t9">Task 9 rating</label>
        <select id="task9_rating" name="task9_rating"><option value="">Select</option><option value="5">5</option><option value="4">4</option><option value="3">3</option><option value="2">2</option><option value="1">1</option></select>
      </div>
    </div>

    <div class="hr"></div>

    <!-- 6) Fatigue -->
    <h2 data-i18n="sec6">6Ô∏è‚É£ Timing & energy</h2>
    <label for="fatigue" data-i18n="q_fatigue">Did you feel tired or lose focus at any point?</label>
    <select id="fatigue" name="fatigue">
      <option value="" data-i18n="select">Select</option>
      <option value="No ‚Äî it stayed dynamic" data-i18n="fa1">No ‚Äî it stayed dynamic</option>
      <option value="Yes ‚Äî around the middle" data-i18n="fa2">Yes ‚Äî around the middle</option>
      <option value="Yes ‚Äî closer to the end" data-i18n="fa3">Yes ‚Äî closer to the end</option>
    </select>

    <div class="hr"></div>

    <!-- 7) Favorite + Improve -->
    <h2 data-i18n="sec7">7Ô∏è‚É£ Open feedback</h2>

    <label for="favorite_moment" data-i18n="q_fav">Your favorite moment of the quest</label>
    <textarea id="favorite_moment" name="favorite_moment" data-i18n-ph="ph_fav"
      placeholder="A specific scene, a funny moment, a place, a task, anything."></textarea>

    <label for="improve" data-i18n="q_improve">What should we improve or add next time?</label>
    <textarea id="improve" name="improve" data-i18n-ph="ph_improve"
      placeholder="Be brutally honest ‚Äî this is the most valuable field üôÇ"></textarea>

    <div class="hr"></div>

    <!-- 8) Public review -->
    <h2 data-i18n="sec8">8Ô∏è‚É£ Public review (anonymous)</h2>
    <div class="muted" data-i18n="pub_note">
      Questions 1‚Äì7 are for internal improvement. Question 8 is separate: an anonymous review we may publish.
    </div>

    <label for="public_review" data-i18n="q_public">Write a short honest review for publication</label>
    <textarea id="public_review" name="public_review" data-i18n-ph="ph_public"
      placeholder="Write a general review so other people can understand the impression of the quest."></textarea>

    <div class="hr"></div>

    <button class="btn" id="submitBtn" type="submit" data-i18n="send">Send feedback</button>
    <div id="msg"></div>

  </form>
</div>

<script type="module">
  import { API_URL } from './config.js';

  const form = document.getElementById('feedbackForm');
  const msg = document.getElementById('msg');
  const btn = document.getElementById('submitBtn');
  const langInput = document.getElementById('lang');

  // Meta
  document.getElementById('device_time').value = new Date().toISOString();
  document.getElementById('source_page').value = location.href;

  function collectChecked(name) {
    return Array.from(form.querySelectorAll(`input[name="${name}"]:checked`))
      .map(n => n.value)
      .join("; ");
  }

  // i18n
  const dict = {
    en: {
      title: "Tbilisi City Quest ‚Äî Feedback",
      intro: "Thank you for joining the quest! This feedback helps me improve the next quests.",
      timehint: "This form takes ~5 minutes. Please answer honestly ‚Äî it really helps üôå",
      select: "Select",
      none: "None",

      sec1: "1Ô∏è‚É£ Overall",
      q_overall_10: "How did you like the Tbilisi City Quest? (1‚Äì10)",

      sec2: "2Ô∏è‚É£ What did you like the most?",
      q_liked_most: "Choose all that apply",
      lm1: "Tasks & questions",
      lm2: "Culture & history",
      lm3: "Route & city",
      lm4: "Bonus questions",
      lm5: "Improv game at the hotel",
      lm6: "Khinkali at Zodiaco",

      sec3: "3Ô∏è‚É£ What task types would you add?",
      q_add_types: "Choose all that apply",
      at1: "Logic puzzles",
      at2: "Music contests",
      at3: "Painting / draw something",
      at4: "Emotional / scary tasks",
      at5: "Sport / obstacle challenges",

      sec4: "4Ô∏è‚É£ Hard or unclear tasks",
      q_hard_task: "Were any tasks too hard? (choose one)",
      hard_note: "(You can rename ‚ÄúTask 1‚Ä¶9‚Äù to your real task names anytime.)",

      sec5: "5Ô∏è‚É£ Rate each task (1‚Äì5)",
      t1: "Task 1 rating",
      t2: "Task 2 rating",
      t3: "Task 3 rating",
      t4: "Task 4 rating",
      t5: "Task 5 rating",
      t6: "Task 6 rating",
      t7: "Task 7 rating",
      t8: "Task 8 rating",
      t9: "Task 9 rating",

      sec6: "6Ô∏è‚É£ Timing & energy",
      q_fatigue: "Did you feel tired or lose focus at any point?",
      fa1: "No ‚Äî it stayed dynamic",
      fa2: "Yes ‚Äî around the middle",
      fa3: "Yes ‚Äî closer to the end",

      sec7: "7Ô∏è‚É£ Open feedback",
      q_fav: "Your favorite moment of the quest",
      ph_fav: "A specific scene, a funny moment, a place, a task, anything.",
      q_improve: "What should we improve or add next time?",
      ph_improve: "Be brutally honest ‚Äî this is the most valuable field üôÇ",

      sec8: "8Ô∏è‚É£ Public review (anonymous)",
      pub_note: "Questions 1‚Äì7 are for internal improvement. Question 8 is separate: an anonymous review we may publish.",
      q_public: "Write a short honest review for publication",
      ph_public: "Write a general review so other people can understand the impression of the quest.",

      send: "Send feedback"
    },

    ru: {
      title: "Tbilisi City Quest ‚Äî –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å",
      intro: "–°–ø–∞—Å–∏–±–æ, —á—Ç–æ —É—á–∞—Å—Ç–≤–æ–≤–∞–ª–∏ –≤ –∫–≤–µ—Å—Ç–µ! –≠—Ç–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –ø–æ–º–æ–∂–µ—Ç —É–ª—É—á—à–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –∫–≤–µ—Å—Ç—ã.",
      timehint: "–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–π–º–µ—Ç ~5 –º–∏–Ω—É—Ç. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–≤–µ—á–∞–π—Ç–µ —á–µ—Å—Ç–Ω–æ ‚Äî —ç—Ç–æ –æ—á–µ–Ω—å –ø–æ–º–æ–≥–∞–µ—Ç üôå",
      select: "–í—ã–±–µ—Ä–∏—Ç–µ",
      none: "–ù–µ—Ç",

      sec1: "1Ô∏è‚É£ –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞",
      q_overall_10: "–ö–∞–∫ –≤–∞–º –≤ —Ü–µ–ª–æ–º –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è Tbilisi City Quest? (1‚Äì10)",

      sec2: "2Ô∏è‚É£ –ß—Ç–æ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ?",
      q_liked_most: "–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤",
      lm1: "–ó–∞–¥–∞–Ω–∏—è –∏ –≤–æ–ø—Ä–æ—Å—ã",
      lm2: "–ö—É–ª—å—Ç—É—Ä–∞ –∏ –∏—Å—Ç–æ—Ä–∏—è",
      lm3: "–ú–∞—Ä—à—Ä—É—Ç –∏ –≥–æ—Ä–æ–¥",
      lm4: "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã",
      lm5: "–ò–º–ø—Ä–æ–≤–∏–∑–∞—Ü–∏–æ–Ω–Ω–∞—è –∏–≥—Ä–∞ –≤ –æ—Ç–µ–ª–µ",
      lm6: "–•–∏–Ω–∫–∞–ª–∏ –≤ Zodiaco",

      sec3: "3Ô∏è‚É£ –ö–∞–∫–∏–µ —Ç–∏–ø—ã –∑–∞–¥–∞–Ω–∏–π –¥–æ–±–∞–≤–∏—Ç—å?",
      q_add_types: "–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤",
      at1: "–õ–æ–≥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏",
      at2: "–ú—É–∑—ã–∫–∞–ª—å–Ω—ã–µ –∫–æ–Ω–∫—É—Ä—Å—ã",
      at3: "–ó–∞–¥–∞–Ω–∏—è —Å –∂–∏–≤–æ–ø–∏—Å—å—é ‚Äî —á—Ç–æ-—Ç–æ –∏–∑–æ–±—Ä–∞–∑–∏—Ç—å",
      at4: "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ-–ø—É–≥–∞—é—â–∏–µ –∑–∞–¥–∞–Ω–∏—è",
      at5: "–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è / –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π",

      sec4: "4Ô∏è‚É£ –°–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è",
      q_hard_task: "–ë—ã–ª–∏ –ª–∏ –∑–∞–¥–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∫–∞–∑–∞–ª–∏—Å—å —Å–ª–æ–∂–Ω—ã–º–∏? (–≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω–æ)",
      hard_note: "(‚ÄúTask 1‚Ä¶9‚Äù –º–æ–∂–Ω–æ –ø–æ—Ç–æ–º –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –≤ —Ä–µ–∞–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π.)",

      sec5: "5Ô∏è‚É£ –û—Ü–µ–Ω–∏—Ç–µ –∫–∞–∂–¥–æ–µ –∏–∑ 9 –∑–∞–¥–∞–Ω–∏–π (1‚Äì5)",
      t1: "–û—Ü–µ–Ω–∫–∞ –∑–∞–¥–∞–Ω–∏—è 1",
      t2: "–û—Ü–µ–Ω–∫–∞ –∑–∞–¥–∞–Ω–∏—è 2",
      t3: "–û—Ü–µ–Ω–∫–∞ –∑–∞–¥–∞–Ω–∏—è 3",
      t4: "–û—Ü–µ–Ω–∫–∞ –∑–∞–¥–∞–Ω–∏—è 4",
      t5: "–û—Ü–µ–Ω–∫–∞ –∑–∞–¥–∞–Ω–∏—è 5",
      t6: "–û—Ü–µ–Ω–∫–∞ –∑–∞–¥–∞–Ω–∏—è 6",
      t7: "–û—Ü–µ–Ω–∫–∞ –∑–∞–¥–∞–Ω–∏—è 7",
      t8: "–û—Ü–µ–Ω–∫–∞ –∑–∞–¥–∞–Ω–∏—è 8",
      t9: "–û—Ü–µ–Ω–∫–∞ –∑–∞–¥–∞–Ω–∏—è 9",

      sec6: "6Ô∏è‚É£ –î–∏–Ω–∞–º–∏–∫–∞ –∏ —ç–Ω–µ—Ä–≥–∏—è",
      q_fatigue: "–ë—ã–ª –ª–∏ –º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ –≤—ã —É—Å—Ç–∞–ª–∏ –∏–ª–∏ –ø–æ—Ç–µ—Ä—è–ª–∏ —Ñ–æ–∫—É—Å?",
      fa1: "–ù–µ—Ç ‚Äî –≤—Å—ë –ø—Ä–æ—à–ª–æ –¥–∏–Ω–∞–º–∏—á–Ω–æ",
      fa2: "–î–∞ ‚Äî –±–ª–∏–∂–µ –∫ —Å–µ—Ä–µ–¥–∏–Ω–µ",
      fa3: "–î–∞ ‚Äî –±–ª–∏–∂–µ –∫ –∫–æ–Ω—Ü—É",

      sec7: "7Ô∏è‚É£ –û—Ç–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã",
      q_fav: "–í–∞—à –ª—é–±–∏–º—ã–π –º–æ–º–µ–Ω—Ç –∫–≤–µ—Å—Ç–∞",
      ph_fav: "–ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Å—Ü–µ–Ω–∞, —Å–º–µ—à–Ω–æ–π –º–æ–º–µ–Ω—Ç, –º–µ—Å—Ç–æ, –∑–∞–¥–∞–Ω–∏–µ ‚Äî —á—Ç–æ —É–≥–æ–¥–Ω–æ.",
      q_improve: "–ß—Ç–æ –±—ã –≤—ã —É–ª—É—á—à–∏–ª–∏ –∏–ª–∏ –¥–æ–±–∞–≤–∏–ª–∏ –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑?",
      ph_improve: "–ë—É–¥—å—Ç–µ —á–µ—Å—Ç–Ω—ã–º–∏ ‚Äî —ç—Ç–æ —Å–∞–º–æ–µ —Ü–µ–Ω–Ω–æ–µ –ø–æ–ª–µ üôÇ",

      sec8: "8Ô∏è‚É£ –û—Ç–∑—ã–≤ –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (–∞–Ω–æ–Ω–∏–º–Ω—ã–π)",
      pub_note: "–í–æ–ø—Ä–æ—Å—ã 1‚Äì7 –º—ã —Å–æ–±–∏—Ä–∞–µ–º –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ —É–ª—É—á—à–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–∏—Ö –∫–≤–µ—Å—Ç–æ–≤. –í–æ–ø—Ä–æ—Å 8 ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π: —ç—Ç–æ –∞–Ω–æ–Ω–∏–º–Ω—ã–π –æ—Ç–∑—ã–≤, –∫–æ—Ç–æ—Ä—ã–π –º—ã –º–æ–∂–µ–º –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –Ω–∞ –Ω–∞—à–∏—Ö —Ä–µ—Å—É—Ä—Å–∞—Ö.",
      q_public: "–ù–∞–ø–∏—à–∏—Ç–µ —á–µ—Å—Ç–Ω—ã–π –æ–±—â–∏–π –æ—Ç–∑—ã–≤ –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏",
      ph_public: "–¢–∞–∫, —á—Ç–æ–±—ã –¥—Ä—É–≥–∏–µ –ª—é–¥–∏, –ø—Ä–æ—á–∏—Ç–∞–≤ –µ–≥–æ, –º–æ–≥–ª–∏ –ø–æ–Ω—è—Ç—å –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ –æ –∫–≤–µ—Å—Ç–µ.",

      send: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
    }
  };

  function applyLang(lang) {
    langInput.value = lang;

    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.getAttribute('data-i18n');
      if (dict[lang][key]) el.textContent = dict[lang][key];
    });

    document.querySelectorAll('[data-i18n-ph]').forEach(el => {
      const key = el.getAttribute('data-i18n-ph');
      if (dict[lang][key]) el.setAttribute('placeholder', dict[lang][key]);
    });

    document.getElementById('btnEN').classList.toggle('active', lang === 'en');
    document.getElementById('btnRU').classList.toggle('active', lang === 'ru');
  }

  document.getElementById('btnEN').addEventListener('click', () => applyLang('en'));
  document.getElementById('btnRU').addEventListener('click', () => applyLang('ru'));
  applyLang('en');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    msg.textContent = '';
    msg.className = '';
    btn.disabled = true;

    document.getElementById('device_time').value = new Date().toISOString();
    document.getElementById('source_page').value = location.href;

    const data = new URLSearchParams();

    data.set('lang', langInput.value);
    data.set('device_time', document.getElementById('device_time').value);
    data.set('source_page', document.getElementById('source_page').value);

    data.set('overall_10', form.overall_10.value);
    data.set('liked_most', collectChecked('liked_most_opt'));
    data.set('add_types', collectChecked('add_types_opt'));

    data.set('hard_task', form.hard_task.value);

    data.set('task1_rating', form.task1_rating.value);
    data.set('task2_rating', form.task2_rating.value);
    data.set('task3_rating', form.task3_rating.value);
    data.set('task4_rating', form.task4_rating.value);
    data.set('task5_rating', form.task5_rating.value);
    data.set('task6_rating', form.task6_rating.value);
    data.set('task7_rating', form.task7_rating.value);
    data.set('task8_rating', form.task8_rating.value);
    data.set('task9_rating', form.task9_rating.value);

    data.set('fatigue', form.fatigue.value);

    data.set('favorite_moment', form.favorite_moment.value.trim());
    data.set('improve', form.improve.value.trim());
    data.set('public_review', form.public_review.value.trim());

    try {
      await fetch(API_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8' },
        body: data.toString()
      });

      msg.textContent = (langInput.value === 'ru')
        ? '–°–ø–∞—Å–∏–±–æ! üôå –û—Ç–∑—ã–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω.'
        : 'Thank you! üôå Your feedback was sent.';
      msg.className = 'ok';

      form.reset();
      applyLang(langInput.value);
    } catch (err) {
      msg.textContent = (langInput.value === 'ru')
        ? '–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.'
        : 'Error: could not send. Please try again.';
      msg.className = 'err';
      console.error(err);
    } finally {
      btn.disabled = false;
    }
  });
</script>
</body>
</html>
